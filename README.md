# CaboVerde_Demographic_Analyses
This repository contains scripts for analyzing population history in Cabo Verde. The following analyses were performed in the Goldberg Lab at Duke University by Katharine Korunes (contact: kkorunes@gmail.com). These analyses were conducted using genotype data originally described in Beleza et al. 2013, which included 563 Cabo Verdeans. Sampling consent forms do not allow for public release of genotype data; however, inferred local ancestry information can be found at https://doi.org/10.5281/zenodo.4021277

#### Scripts for obtaining ancestry reference panels, clustering, and estimating ancestry are contained in the subdirectory "PreparingAncestryData":
This directory contains all scripts used for obtaining/formatting reference population data from the 1000 Genomes Project, running PCA, estimating admixture proportions, and preparing to call local ancestry. To estimate admixture proportions and call local ancestry in the Cabo Verde individuals, we merged the Cabo Verde genotypes with genotypes from 107 GWD (Gambian in Western Division - Mandinka) and 107 IBS (Iberian Population in Spain) samples called from high-coverage resequencing data released through the International Genome Sample Resource (Clarke et al., 2017; Fairley, Lowy-Gallego, Perry, & Flicek, 2020). To produce estimates of admixture proportions, we first performed unsupervised clustering of the samples using ADMIXTURE (Alexander, Novembre, & Lange, 2009), and we estimated individual ancestries by averaging over ten independent ADMIXTURE runs using K = 2. ADMIXTURE was run separately for the autosomal and X chromosome datasets after pruning based on linkage disequilibrium (LD) using the indep-pairwise option of PLINK v1.9 with a 50-SNP sliding window incremented by 10 SNPs, and an LD threshold of r2 = 0.5 (Purcell et al., 2007). We also clustered the samples using PLINK’s Principal component analysis (--pca) function, using this pruned dataset. Note that phasing and local ancestry calling details as well as the local ancestry calls are publicly available via Zenodo at https://doi.org/10.5281/zenodo.4021277 --briefly, we phased all samples using SHAPEIT2 (Delaneau, Zagury, & Marchini, 2013), and then called local ancestry with RFMix (Maples, Gravel, Kenny, & Bustamante, 2013) using a two-way admixture model using the West African and European reference genotypes.

#### Scripts for inference of admixture timing are contained in the subdirectory "AdmixtureTiming":
This directory includes scripts for our application of three distinct strategies for estimating the timing of the onset of admixture in Cabo Verde: ALDER (Loh et al., 2013), MultiWaver 2.0 (Ni et al., 2019), and a method based on patterns of linkage disequilibrium between local ancestry tracts (Zaitlen et al., 2017). We first converted the genotypes to EIGENSTRAT format using convertf (Patterson, Price, & Reich, 2006; Price et al., 2006). We then used ALDER to date admixture timing on each island using default parameters with mindis  =  0.005 and source populations GWD and IBS. We ran MultiWaver using the ancestry tracts inferred by RFMix, default parameters, and 100 bootstraps. Finally, we followed the pipeline of Zaitlen et al. (2017) and its accompanying scripts to use the RFMix local ancestry calls to measure local ancestry disequilibrium (LAD) decay in 10 Mb windows, overlapping by 1 Mb. Specifically, we started with the first SNP on each autosome, used the 10 Mb window end point to identify the SNP closest to the inside of this boundary, and then used local ancestry calls at these positions to determine LAD. We repeated this process along each chromosome to obtain LAD in 279 autosomal windows. Using possible values of admixture generations ranging from 5-25, we determined the best fit using island-specific mean LAD decay over the 279 autosomal windows, assortative mating parameters estimated with ANCESTOR (see below), a starting autosomal admixture proportion of 0.65, and either no migration or with migration (migration rate = 0.01).

#### Scripts for IBD detection, ROH calling, and tests of nonrandom mating are containing in the subdirectory "RelatednessAndMatingPatterns":
This directory contains all scripts used for IBD detection, ROH calling, and tests of nonrandom mating. We tested for assortative mating over the last generation using ANCESTOR (Zou, Halperin, Burchard, & Sankararaman, 2015; Zou, Park, et al., 2015). Following the analysis pipeline of S. R. Browning et al. (2018), we inferred segments of IBD using the haplotype-based IBD detection method Refined IBD (B. L. Browning & Browning, 2013), and we estimated ancestry-specific population size using IBDNe (S. R. Browning & Browning, 2015). After running Refined IBD, we used its gap-filling utility to remove gaps between segments less than 0.6 cM that had at most one discordant homozygote. We then filtered out IBD segments smaller than 5 cM, as short segments below this threshold are difficult to accurately detect (Nelson et al., 2020). To visualize IBD sharing in Fig 1 and Supp Fig 2, the sum of IBD shared in each pairwise comparison of individuals was plotted by using Cytoscape 3.8 to group nodes by island, position nodes within each island according to a prefuse force-directed algorithm, and scale the color of edges based on log-transformed total IBD length (Shannon et al., 2003). We called ROH using GARLIC v.1.1.6 (Szpiech, Blant, & Pemberton, 2017), which implements the ROH calling pipeline of Pemberton et al. (2012). We performed this analysis separately for the autosomes and X chromosome. Following best-practices described in Szpiech et al. (2017), we used a single constant genotyping error rate of 0.001, we allowed GARLIC to automatically choose a window size for each population (--auto-winsize), and we used the resample flag to mitigate biases in allele frequency estimates caused by differing sample sizes. This resulted in GARLIC selecting a window size of 50 SNPs in each of the Cabo Verde regions and in GWD, and a window size of 40 for IBS. Using a three-component Gaussian mixture model, GARLIC classified ROH into three length groups: small/class A, medium/class B, and long/class C ROH. Across all populations, Class A/B and class B/C size boundaries were inferred as approximately 300 kb and 1 Mb, respectively (see Supp Table 1 in the associated preprint for population-specific parameters, including LOD cutoffs and size boundaries). Using only the females, we then classified ROH for the X chromosome.
